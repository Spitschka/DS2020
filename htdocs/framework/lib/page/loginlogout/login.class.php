<?phpclass login extends AbstractPage {	public function __construct() {		parent::__construct("Startseite");				if(DB::isloggedin()) {			header("Location: index.php");			exit;		}	}	public function execute() {				$success = false;		$username = '';					if($_POST['username'] == "" || $_POST['password'] == "") {								eval("DB::getTPL()->out(\"".DB::getTPL()->get("login/index")."\");");							exit();		}				$userinfo = PortalApi::getUserinformationen($_POST['username'], $_POST['password']);				if($userinfo != null) {		    $success = true;		    $username = strtoupper($_POST['username']);		}						if($success != false) {		    $user = DB::getDB()->query_first("SELECT * FROM users WHERE userName LIKE '" . DB::getDB()->escapeString($username) . "'");		    if($user['userID'] > 0) {		        DB::getDB()->query("UPDATE users SET                    userName = '" . DB::getDB()->escapeString($username) . "',                    userFirstName = '" . DB::getDB()->escapeString($userinfo['vorname']) . "',                    userLastName = '" . DB::getDB()->escapeString($userinfo['nachname']) . "',                    userIsAdmin = '" . ($userinfo['isAdmin'] > 0) . "',                    userIsLehrer = '" . ($userinfo['isLehrer'] > 0) . "',                    userIsEltern = '" . ($userinfo['isEltern'] > 0) . "',                    userIsSchueler = '" . ($userinfo['isSchueler'] > 0) . "',                    userIsSekretariat = '" . ($userinfo['isSekretariat'] > 0) . "',                    userSchuelerAsvID = '" . DB::getDB()->escapeString($userinfo['schuelerAsvID']) . "',                    userLehrerAsvID = '" . DB::getDB()->escapeString($userinfo['lehrerAsvID']) . "',                    userElternSchuelerAsvIDs = '" . DB::getDB()->escapeString($userinfo['elternSchuelerAsvIDs']) . "' WHERE userID='" . $user['userID'] . "'");		        		        $userID = $user['userID'];		    }		    else {        		    DB::getDB()->query("INSERT INTO users (                    userName,                    userFirstName,                    userLastName,                    userIsAdmin,                    userIsLehrer,                    userIsEltern,                     userIsSchueler,                    userIsSekretariat,                    userSchuelerAsvID,                    userLehrerAsvID,                    userElternSchuelerAsvIDs                    ) values (                        '" . DB::getDB()->escapeString($username) . "',                        '" . DB::getDB()->escapeString($userinfo['vorname']) . "',                        '" . DB::getDB()->escapeString($userinfo['nachname']) . "',                        '" . ($userinfo['isAdmin'] > 0) . "',                        '" . ($userinfo['isLehrer'] > 0) . "',                        '" . ($userinfo['isEltern'] > 0) . "',                        '" . ($userinfo['isSchueler'] > 0) . "',                        '" . ($userinfo['isSekretariat'] > 0) . "',                        '" . DB::getDB()->escapeString($userinfo['schuelerAsvID']) . "',                        '" . DB::getDB()->escapeString($userinfo['lehrerAsvID']) . "',                        '" . DB::getDB()->escapeString($userinfo['elternSchuelerAsvIDs']) . "'                    )                ");    		    $userID = DB::getDB()->insert_id();		    }		    		    						$sessionID = sha1(rand().rand()) . sha1(rand().rand());												DB::getDB()->query("INSERT INTO sessions 					(sessionID, sessionUserID, sessionType, sessionIP, sessionLastActivity, sessionBrowser, sessionDevice)					values						(							'" . $sessionID . "',							'" . $userID . "',							'" . (($_POST['keeplogin'] > 0) ? ("SAVED") : ("NORMAL")) . "',							'" . $_SERVER['REMOTE_ADDR'] . "',							UNIX_TIMESTAMP(),							'" . $_SERVER['HTTP_USER_AGENT'] . "',							''						)			");									setcookie("ds2020session", $sessionID, (($_POST['keeplogin'] > 0) ? (time() + 365 * 24 * 60 * 60) : (0)));									if($_POST['redirectPage'] != "" && in_array($_POST['redirectPage'],requesthandler::getAllowedActions())) {				header("Location: index.php?page=" . $_POST['redirectPage']);				exit(0);			}			else {								header("Location: index.php");				exit(0);			}		}		else {			$message = "<div class=\"callout callout-danger\">		          <p><strong>Die Anmeldung war leider nicht erfolgreich!</strong></p>		        </div>				";						$valueusername = DB::getDB()->escapeString($_POST['username']);						eval("echo(\"".DB::getTPL()->get("login/index")."\");");						exit();		}			}		public static function hasSettings() {		return true;	}		/**	 * Stellt eine Beschreibung der Einstellungen bereit, die für das Modul nötig sind.	 * @return array(String, String)	 * array(	 * 	   array(	 * 		'name' => "Name der Einstellung (z.B. formblatt-isActive)",	 *		'typ' => ZEILE | TEXT | NUMMER | BOOLEAN,	 *      'titel' => "Titel der Beschreibung",	 *      'text' => "Text der Beschreibung"	 *     )	 *     ,	 *     .	 *     .	 *     .	 *  )	 */	public static function getSettingsDescription() {		return array();	}			public static function getSiteDisplayName() {		return '';	}		public static function siteIsAlwaysActive() {		return true;	}	}?>